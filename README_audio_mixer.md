# 音频混合脚本使用说明

## 功能

将配音与背景音乐混合，生成完整的带背景音的音频文件。

## 特性

- ✅ 背景音乐音量30%（配音为主）
- ✅ 音乐自动循环直到配音结束
- ✅ 结尾3秒渐出效果
- ✅ 支持单篇测试和批量处理
- ✅ 随机选择背景音乐

## 使用方法

### 1. 单篇测试（推荐先测试）

测试第一篇文章：
```bash
python mix_audio_with_bgm_v2.py
```

测试指定文章（如第5篇）：
```bash
python mix_audio_with_bgm_v2.py --article 005
```

### 2. 批量处理所有文章

```bash
python mix_audio_with_bgm_v2.py --batch
```

## 文件结构

```
claude/
├── audio_output/           # 原始配音文件
│   ├── 001_xxx.mp3
│   ├── 002_xxx.mp3
│   └── ...
├── 素材/                   # 背景音乐文件夹
│   ├── 2.mp3
│   ├── 3.mp3
│   └── 4.mp3
└── audio_with_bgm/         # 输出文件夹（混合后的音频）
    ├── 001_xxx_with_bgm_4.mp3
    ├── 002_xxx_with_bgm_2.mp3
    └── ...
```

## 技术参数

### 音频混合参数
- **配音音量**: 100% (原始)
- **背景音乐音量**: 30% (0.3)
- **渐出时长**: 3秒
- **输出码率**: 192 kbps
- **采样率**: 24 kHz (保持原始)

### FFmpeg处理流程

1. **循环背景音乐**: 使用 `aloop` 滤波器无限循环
2. **裁剪长度**: 使用 `atrim` 裁剪到配音长度
3. **调整音量**: 使用 `volume` 滤波器设置为30%
4. **渐出效果**: 使用 `afade` 滤镜在最后3秒淡出
5. **混合**: 使用 `amix` 滤镜混合配音和BGM

## 测试结果

第一篇文章测试成功：
- **时长**: 9分42秒
- **文件大小**: 12 MB
- **背景音乐**: 4.mp3 (循环7次)
- **效果**: 配音清晰，背景音乐柔和

## 批量处理建议

### 选项1: 全部处理
```bash
python mix_audio_with_bgm_v2.py --batch
```
- 优点: 一次完成所有文章
- 缺点: 耗时较长（每篇约10分钟）

### 选项2: 分批处理
可以修改脚本分批处理，例如：
```bash
# 先处理前10篇
# 修改脚本中的 voice_files 列表
# 或手动移动文件到临时文件夹
```

## 常见问题

### Q: 背景音乐音量怎么调？
A: 修改脚本中的 `bgm_volume=0.3` 参数（0.0-1.0）

### Q: 渐出时间怎么调？
A: 修改脚本中的 `fade_out_duration=3` 参数（秒）

### Q: 如何固定使用某个背景音乐？
A: 在脚本中指定 `bgm_file` 而不是随机选择

### Q: 输出音质怎么调？
A: 修改 `-b:a` 参数（当前192k）

## 下一步

确认测试音频满意后，可以：
1. 审核第一篇混合音频
2. 批量处理所有22篇文章
3. 生成最终版本用于发布

---

**测试文件位置**: `audio_with_bgm/001_with_bgm_4.mp3`

请试听并反馈效果！
